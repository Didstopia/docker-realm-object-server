# Run as root
sudo: required

# No specific environment necessary
language: generic

# Install Docker support
services:
  - docker

# Prepare the environment
before_install:
  - bash .travis/setup.sh

# Install dependencies
install:
  - sudo apt-get install -y curl httpie jq

# Build and test the image
script:
  - bash .travis/build.sh
  - bash .travis/test.sh

# Create and push a new tag
after_success:
  - bash .travis/deploy.sh

# Don't build tags to avoid recursion
branches:
  except:
    - /^v[0-9]/
